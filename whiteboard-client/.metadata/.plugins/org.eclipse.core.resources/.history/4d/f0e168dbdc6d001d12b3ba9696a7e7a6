package application;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;

public class Comms implements Runnable {
	
	public boolean close = false;
	public boolean connected = false;
	
	String host;
	int port;
	
	DataInputStream din;
	DataOutputStream dout;
	
	public String toPost = "";
	
	public Comms(String host, int port) {
		this.host = host;
		this.port = port;
	}
	
	void postState() throws IOException {
		dout.writeUTF(toPost);
		dout.flush();
		
		String str = din.readUTF();
		if(str.equals("ack")) {
			System.out.println("Server accepted state change");
			toPost = "";
		}
		else {
			System.out.println("Unknown server message");
		}
	}
	
	void receiveState() throws IOException {
		String str = din.readUTF();
	}

	@Override
	public void run() {
		
		try {
			Socket s = new Socket(host, port);
			connected = true;
			din = new DataInputStream(s.getInputStream());
			dout = new DataOutputStream(s.getOutputStream());
			
			while(!close) {
				if(toPost.equals("")) {
					Thread.sleep(10);
				} else {
					postState();
				}
			}
			
			din.close();
			dout.close();
			s.close();
			connected = false;
			
		} catch(Exception e){ System.out.println(e); }
	}
	
}
