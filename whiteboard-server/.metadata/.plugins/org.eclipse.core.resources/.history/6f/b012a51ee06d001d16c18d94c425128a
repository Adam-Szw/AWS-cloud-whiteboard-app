package whiteboard_server;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

public class ClientConnection implements Runnable {
	
	Server server;
	int port;
	ServerSocket ss;
	Socket s;
	
	DataInputStream din;
	DataOutputStream dout;
	
	boolean close = false;
	
	String response = "";
	
	public ClientConnection(Server server, int port, ServerSocket ss, Socket s) throws IOException {
		this.server = server;
		this.port = port;
		this.ss = ss;
		this.s = s;
		din = new DataInputStream(s.getInputStream());
		dout = new DataOutputStream(s.getOutputStream());
	}
	
	@Override
	public void run() {
		try {
			while(!close) {
				receiveState();
			}
			
			din.close();
			dout.close();
			s.close();
			ss.close();
			
		} catch(Exception e){System.out.println(e);}
	}
	
	void writeMessage() throws IOException {
		dout.writeUTF(response);
		dout.flush();
	}
	
	void receiveState() throws IOException {
		String str = din.readUTF();
		server.serverState += str;
		server.updater = this;
		String response = "ack";
		System.out.println("state received: " + str);
		dout.writeUTF(response);
		dout.flush();
	}
	
	void sendState(String state) throws IOException {
		dout.writeUTF(state);
		dout.flush();
	}
	
	public void close() {
		close = true;
	}

}
